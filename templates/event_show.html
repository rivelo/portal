<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>{{event.name}} [{{event.date|date:"d.m.Y"}}]</title>


<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

{% load poll_extras %}

<style>

.event_title {
/*    content: "";
    clear: both;
    display: table; */
    background: #ededed /* #eeeee5 */ ; 
	border: 1px dashed #abab9a; 
	padding: 5px; 
/*	width: 100%; */ 
	box-sizing: border-box;
}

div.poster, div.gps, div.map 
{
	cursor: pointer;
}


      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 450px !important;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>

<script>
$(document).ready(function(){
//    $("img.poster").hide();
	$("#map").hide();

    $("div.poster").click(function(){
    	var div_p = $(this)
    	var id = $(this).attr("ids")
    	if ($(this).find("h5").html() == "Показати афішу") {
    		$(this).find("h5").html("Приховати афішу");
    		$(this).find("div.poster_content").html('<img src="'+ div_p.attr("img") + '" class="img_poster" id="pimg_'+ id +'">')
    	}
    	else {
    		$(this).find("h5").html("Показати афішу")
    		$(this).find("div.poster_content").empty();
    	}
        // $("#pimg_"+id).toggle();
    });


    $("div.gps").click(function(){
    	var gps_c = $(this).find(".gps_content")
    	if ($(this).find("h5").html() == "Показати маршрут") {
    		$(this).find("h5").html("Приховати маршрут");    	
            $.ajax({
                type: "POST",
                url: "/event/gps/get/",
                data: { eid: $(this).attr("ids") },
                dataType: "json",
                success:function(msg){
                	$.each(msg,function(index,item){
						gps_c.html(item['gps_track'])
						console.log("GPS TRACK = " + item['gps_track'])
                    });
                },
                error:function(xhr, ajaxOptions, thrownError){
                    alert( xhr.responseText );
                }
            });
         }
         else {
         	$(this).find("h5").html("Показати маршрут")
    	 	gps_c.empty();
         }
    })

	$("div.map").click(function(){
		if ($(this).find("h5").html() == "Показати місце старту") {
    		$(this).find("h5").html("Приховати місце старту");    
		}
		else {
			$(this).find("h5").html("Показати місце старту");
		}
		//console.log("MAP click")
		//$(this).find("div.map_content").html($("#map"));
		//$("#map").show();
		$("#map").toggle();
//		initMap($(this).attr("lat"), $(this).attr("lng"));
		//initMap();
	})

});

</script>

{% block content %}


<div class="container-fluid mt-1" >
<div class="row event_title align-items-center poster" >
<div class="col-2 my-auto" style="padding-left: 0px;">
{% if event.icon %}
  <img class="img-thumbnail" src="/media/{{event.icon}}" height="120px" width="120px"></img>	
{% endif %}
</div>

<div class="col-10">
<h2>
{% if user.is_authenticated and user|has_group:"moder" %}
<a href="{% url 'event-show' event.pk %}">
{% else %}
<a href="#" style="pointer-events: none; ">
{% endif %}
{{event.name}} [{{event.date|date:"d.m.Y"}}] 
{% if event.city %}
({{event.city}})
{% endif %}
</a> 

{% if user.is_authenticated and user|has_group:"moder" %}
<a href="/event/{{event.pk}}/edit/" title="Редагувати" style="color:gray;"> <i class="material-icons">create</i></a> 
{% endif %}
</h2>
</div>

</div>

<div class="row" >
<div class="col-12">

{% if event.photo %}
        <div class="row align-items-center poster" ids="{{event.pk}}" img="/media/{{event.photo}}">
            <div class="col-xs-10" ><h5>Показати афішу</h5></div>
            <div class="col-xs-2 my-auto" style="padding-right: 10px; padding-left: 15px"><img src="/media/images/poster-icon.png" class="img-responsive" alt="Афіша" width="48px"></div>            
            <div class="col-xs-12 poster_content"></div>
        </div>
{% endif %} 
 
{% autoescape off %}
{{event.text}}
{% endautoescape %} 
</div>
</div>

{% if user.is_authenticated and user|has_group:"moder" and event.cup %}
<h5>
<a type="button" class="btn btn-info btn-lg" style="font-size: 14px" href="{% url 'events_sale' 'rivno100' %}">Список товарів "Рівно100"</a>
<a type="button" class="btn btn-info btn-lg" style="font-size: 14px" href="{% url 'events_sale' 'med' %}">Список товарів "Медовий трейл"</a>
<a type="button" class="btn btn-info btn-lg" style="font-size: 14px" href="{% url 'events_sale' '100mile' %}">Список товарів "100 миль"</a>
</h5>
{% endif %}

<div class="row " >
{# <div class="col-12"> #} 


{% if event.forum_url %}
<h5>Посилання на форум:
<small> <a href="{{event.forum_url}}">{{event.forum_url}}</a> </small>
</h5>
{% endif %}

{#</div>#}
</div>



{# [start-custom format='Ymd\\THi00\\Z']/[end-custom format='Ymd\\THi00\\Z'] #}


<div class="row align-items-center poster" ids="{{event.pk}}" img="/media/{{event.photo}}">
<h5> Додати подію в календар
<a href="http://www.google.com/calendar/event?
action=TEMPLATE
&text=Рівно100
&dates=20180513/20180514
&details=Веломарафон+Рівно100
&location=Рівне+Рівненська+область
&sprop=rivelo.com.ua
&trp=false&sprop=&sprop=name:
"
target="_blank" rel="nofollow">Add to Calendar</a>
</h5>
</div>


{% if event.gps_track %}
<div class="row align-items-center gps" ids="{{event.pk}}">
<div class="col-xs-10" ><h5>Показати маршрут</h5></div>
<div class="col-xs-2 my-auto" style="padding-right: 10px; padding-left: 15px"><img src="/media/images/gps128.png" alt="" title="Показати маршрут" width="48px" style="vertical-align:middle;" ></img></div>
<br>
<div class="col-xs-12 gps_content"></div>
</div>
{% endif %}

<div class="row" >
<h5> Дата та час: {{event.date|date:"d-m-Yр. H:i"}} <small class="text-danger"> (До заходу залишилось {{event.days_left}} днів)</small></h5>
</div>

</div> {# end container #}

{% if event.reg_status == True %}
<h5>Реєстрація:  
{% if event.days_left == 0 %}
<a href="{% url 'event-registration' event.pk %}" class="btn btn-success btn-lg disabled"><h4> Перейти до реєстрації </h4><span class="text-white">Реєстрацію завершено</span></a>
{% else %}
<a href="{% url 'event-registration' event.pk %}" class="btn btn-success btn-lg"><h4> Перейти до реєстрації </h4></a>
{% endif %}
</h5>
<ul class="rules">
<b>Вартість реєстрації:</b>
{% for rule in event.rules.all %}
<li> - {{rule}}
{% if  rule.cur_date_rule %}
<b style="color: red;">*{{rule.cur_date_rule}}</b>
{% endif %}
</li> 
{% endfor %}
* можливість вибрати стартовий номер <b>+5грн</b>
</ul>

<h5>Учасники:  
<a href="/event/{{event.pk}}/registration/list/" type="button" class="btn btn-success btn-lg" style="font-size: 14px">
  Список зареєстрованих учасників: <span class="badge badge-light btn-lg" style="font-size: 20px">{{event.riders_count}}</span> чоловік
</a>
{% if user.is_authenticated and user|has_group:"moder" %}
<a type="button" class="btn btn-info btn-lg" style="font-size: 14px" href="{% url 'event-start-list' event.pk %}">Стартовий протокол</a>
<a type="button" class="btn btn-secondary btn-lg" style="font-size: 14px" href="{% url 'download-csv' event.pk %}">Завантажити CSV файл Стартовий</a>
<a type="button" class="btn btn-secondary btn-lg" style="font-size: 14px" href="{% url 'download-csv-numbers' event.pk %}">Завантажити CSV файл з номерками учасників</a>

{% endif %}
</h5>

{% endif %}

{% if event.reg_url != '' %}
<h5>Реєстрація:  
<a href="{{event.reg_url}}">Перейти до реєстрації</a>
</h5>
{% else %}
{% endif %}

{% if event.result_present %} 
<h5>Результати:  
<a class="btn btn-info" style="font-size: 18px" href="{% url 'event-result' event.pk %}">Результати</a>
</h5>
{% endif %}

{% if user.is_authenticated and user|has_group:"moder" and event.cup %}
<a type="button" class="btn btn-warning" href="{% url 'event-result-light-admin' id=event.pk  point='kp1' %}"><<Проста версія КП1>></a>  
<a type="button" class="btn btn-warning" href="{% url 'event-result-light-admin' id=event.pk point='kp2' %}"><<Проста версія КП2>></a>  
<a type="button" class="btn btn-warning" href="{% url 'event-result-light-admin' id=event.pk point='kp3' %}"><<Проста версія КП3>></a>  
<a type="button" class="btn btn-warning" href="{% url 'event-result-light-admin' id=event.pk point='finish' %}"><<Проста версія Finish>></a> <br><br>
{% endif %} 

<div class="container-fluid " >
<div class="row map align-items-center" lat="{{event.lat}}" lng="{{event.lng}}">
<div class="col-xs-10" ><h5>Показати місце старту</h5></div>
<div class="col-xs-2 my-auto" style="padding-right: 10px; padding-left: 15px"><img src="/media/images/Map-Markers.ico" alt="" title="Показати місце старту" width="35px" style="vertical-align:middle;" ></img></div>
<br>
<div class="col-xs-12 map_content"></div>
</div>

<div id="map">  </div>

</div>

<p class="meta"><em>{ Опубліковано <a href="#"> {{event.user.username}} </a>, {{event.pub_date}} }</em></p>




{% load l10n %}

    <script>
    function initMap() {
    	  var myLatLng = {lat: {{event.lat|unlocalize}}, lng: {{event.lng|unlocalize}} };

    	  var map = new google.maps.Map(document.getElementById('map'), {
    	    zoom: 17,
    	    center: myLatLng
    	  });

    	  var marker = new google.maps.Marker({
    	    position: myLatLng,
    	    map: map,
    	    title: 'Місце стартового містечка'
    	  });
    	  
    	}
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDi7un6YABjbV1566j5i8qhpRD9F83f1TQ&callback=initMap" async defer></script> 

	
{% endblock %}

	