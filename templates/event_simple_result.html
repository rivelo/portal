<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<link href="/media/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css"/>
<script src="/media/jquery.dataTables.min.js"></script>
<script src="/media/jquery.jeditable.mini.js" type="text/javascript" charset="utf-8"></script>


<style>
/* Style The Dropdown Button */
.dropbtn {
    background-color: #4CAF50;
    color: white;
    padding: 16px;
    font-size: 16px;
    border: none;
    cursor: pointer;
}

/* The container <div> - needed to position the dropdown content */
.dropdown {
    position: relative;
    display: inline-block;
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}

/* Links inside the dropdown */
.dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

/* Change color of dropdown links on hover */
.dropdown-content a:hover {background-color: #f1f1f1}

/* Show the dropdown menu on hover */
.dropdown:hover .dropdown-content {
    display: block;
}

/* Change the background color of the dropdown button when the dropdown content is shown */
.dropdown:hover .dropbtn {
    background-color: #3e8e41;
}

/*tfoot {
    display: table-header-group;
}
*/
tfoot input {
        width: 100%;
        padding: 3px;
        box-sizing: border-box;
    }
    
#event_stat:hover {
background-color: yellow;
cursor: pointer;
}

.cat_showhide:hover {
background-color: yellow;
cursor: pointer;
}


.hover-content {
    display:none;
}
 
.pay_type:hover .hover-content {
    display:block;
}

.category:hover .hover-content {
    display:block;
} 

</style>


<script>
$(document).ready(function(){
	$("#dialog_start").hide();	

	$( "#tabs" ).tabs();
	$( "#tabs" ).hide()

	$( "#event_stat" ).click(function() {
//  		$( "#tabs" ).show()
  		if ($("#event_stat").html() == "Показати результати") {
    		$("#event_stat").html("Приховати результати");
    	}
    	else {
    		$("#event_stat").html("Показати результати");
    	}
    	$( "#tabs" ).toggle()
	});

	
       
$("body").on("click",".finish_add",function(e){ 	
    $(this).editable('/rider/result/add/', {
    	id: 'point', 
    	loadtype: 'POST',
         submit : 'OK',
         tooltip   : 'Click to add time',
         style   : 'inherit',
         event : "click",
         submitdata : function() {
          	return {rid : $(this).attr('rid'), point: 'finish'};
         },
        }).trigger("focus"); 
});   
    
 
$("body").on("click",".kp1_add",function(e){ 	
	$(this).editable('/rider/result/add/', { 
	 id: 'point',
	 
	 loadtype: 'POST',
     submit : 'OK',
     tooltip   : 'Click to add time',
     style   : 'inherit',
     event : "click",
     submitdata : function() {
      	return {rid : $(this).attr('rid'), point: 'kp1'};
    	 },
    }).trigger("focus"); 
});   


$("body").on("click",".start_status",function(e){ 	
	$(this).editable('/rider/startstatus/', {
     data   : "{'True':'True','False':'False'}",
     loadtype: 'POST',
     type   : 'select',
     submit : 'OK',
     tooltip   : 'Click to edit...',
     style   : 'inherit',
     event : "dblclick",
     submitdata : function() {
      	return {rid : $(this).attr('rider_id')};
    	 },
     callback : function(value, settings) {
         var obj = jQuery.parseJSON(value);
         console.log(obj);
         str = '[' + obj['status'] + "]";
         $(this).html(str);
     }
    }).trigger("focus"); 
});   


$("body").on("click", ".n_riders", function(e){
	var d = $(this);
	$.ajax({
        type: "POST",
        url: "/rider/result/add/",
{% if uname == "kp1" %}                
        data: { rid: $(this).attr("rid"), point: 'kp1', value: ''},
{% endif %}
{% if uname == "kp2" %}                
        data: { rid: $(this).attr("rid"), point: 'kp2', value: ''},
{% endif %}        
{% if uname == "kp3" %}                
        data: { rid: $(this).attr("rid"), point: 'kp3', value: ''},
{% endif %}        
{% if uname == "finish" %}                
        data: { rid: $(this).attr("rid"), point: 'finish', value: ''},
{% endif %}        
        dataType: "json",
        success:function(){
//        	$(this).find("div.gps_content").empty();
			console.log("THIS = " + $(this))
    		$('#rtable tr:last').after('<tr><td>'+d.attr("number")+'</td><td>TEST</td></tr>');
    		$(this).hide();
        },
        error:function(xhr, ajaxOptions, thrownError){
            //alert( xhr.responseText );
            console.log("THIS error = " + d.find('h3:last').html() )
            $('#rtable tr:last').after('<tr><td>'+d.attr("number")+'</td><td>'+d.find('h3:first').html()+'</td><td>'+d.find('h3:last').html()+'</td><td></td><td></td><td></td><td>'+xhr.responseText+'</td><td></td></tr>');
            d.hide();
        }
    });	
 });


});



</script>

{% load poll_extras %}

{% block content %}




<!-- dialog for client message -->
<div id="dialog_start" title="Старт заходу">
<input type="text" id="dsedit" name="mytext[]" cols="40"> </input>
</div>	

<br>
<div style="width:560px; float:left;">
<h2 class="title"> Відмітка {{uname}} {% if user.is_authenticated %}<a href="{% url 'event-result' event.pk %}"><<Повні результати>></a> {% endif %} <br><a href="{% url 'event-show' event.pk %}">{{event.name}}</a> </h2>
<br>
</div>

<div style="float:right;">
	{% if event.icon %}
	<img src="/media/{{event.icon}}" />
	{% endif %} 
</div>

<div style="clear:left;">

{% for rider in list %}
<div class="n_riders" rid="{{rider.reg_event.id}}" number="{{rider.reg_event.start_number}}" style="width:240px; height:135px; color: black;
{% if rider.reg_event.category.0 == 1 %} 
{% if rider.reg_event.sex = 1 %}
	background-color: yellow;"
{% else %}
	background-color: pink;"
{% endif %}
{% endif %}
{% if rider.reg_event.category.0 == 2 %} 
{% if rider.reg_event.sex = 1 %}
	background-color: blue;"
{% else %}
	background-color: purple;"
{% endif %}
{% endif %}
{% if rider.reg_event.category.0 == 3 %} 
	background-color: green;"
{% endif %}
{% if rider.reg_event.category.0 == 4 %} 
	background-color: red;"
{% endif %}
{% if rider.reg_event.category.0 == 5 %} 
	background-color: white;"
{% endif %}
>
<h1 align="center" style="font-size: 500%; font-family: Impact, Times New Roman, Georgia, Serif;">{{rider.reg_event.start_number}}</h1>
<h3 align="center">
{{rider.reg_event.fname}} {{rider.reg_event.lname}}</h3>
<h3 align="center">{{rider.reg_event.nickname}}</h3>
{% if uname == "kp1" %}                	
	<p>{{rider.kp1|date:'H:i:s'}}</p>
{% endif %}	
{% if uname == "kp2" %}                
	<p>{{rider.kp1|date:'H:i:s'}}</p>
{% endif %}	
{% if uname == "kp3" %}       
	<p>{{rider.kp2|date:'H:i:s'}}</p>
{% endif %}
{% if uname == "finish" %}       
	<p>{{rider.kp3|date:'H:i:s'}}</p>
{% endif %}
</div>
{% endfor %}

<table id="rtable" class="display" cellspacing="0" width="100%">
<thead>
<tr>
<th title="Стартовий номер">№</th>
<th>Ім'я / Прізвище</th>
<th>Нік</th>
<th title="Стать">С</th>
<th>Місто</th>
<th>Категорія</th>
{% if uname == "kp1" %}                	
	<th title="КП1">КП1</th>
{% endif %}	
{% if uname == "kp2" %}                
	<th title="КП1">КП2</th>
{% endif %}	
{% if uname == "kp3" %}       
	<th title="КП1">КП3</th>
{% endif %}
{% if uname == "finish" %}       
	<th title="КП1">Фініш</th>
{% endif %}

{% if user.is_authenticated %}
<th>Телефон</th>
{% endif %}
</tr>
</thead>
<tbody>
{% for rider in list_res %}
<td>
{{rider.reg_event.start_number}}
</td>
<td>{{rider.reg_event.fname}} {{rider.reg_event.lname}}</td>
<td>{{rider.reg_event.nickname}}</td>
<td align="center">
{% if rider.reg_event.sex = 1 %}
	<img src="/media/images/male-icon_35.png" height="20" alt="Чоловік" title="Чоловік"></img>
{% else %}
	<img src="/media/images/female-icon_35.png" height="20" alt="Жінка" title="Жінка"></img>
{% endif %}
</td>
<td>{{rider.reg_event.city}}</td>

<td align="center" class="category"
{% if rider.reg_event.category.0 == 1 %} 
{% if rider.reg_event.sex = 1 %}
	style="background-color: yellow;"
{% else %}
	style="background-color: pink;"
{% endif %}
{% endif %}
{% if rider.reg_event.category.0 == 2 %} 
{% if rider.reg_event.sex = 1 %}
style="background-color: blue;"
{% else %}
	style="background-color: purple;"
{% endif %}
{% endif %}
{% if rider.reg_event.category.0 == 3 %} 
style="background-color: green;"
{% endif %}
{% if rider.reg_event.category.0 == 4 %} 
style="background-color: red;"
{% endif %}
{% if rider.reg_event.category.0 == 5 %} 
style="background-color: white;"
{% endif %}

>
<!-- {{rider.reg_event.birthday|date:"Y"}}  --> 
{{rider.reg_event.category.1}} <div class="hover-content">{{rider.reg_event.category.0}}</div> </td>


	<td align="center">
{% if uname == "kp1" %}                	
	{{rider.kp1|date:'H:i:s'}}
{% endif %}	
{% if uname == "kp2" %}                
	{{rider.kp2|date:'H:i:s'}}
{% endif %}	
{% if uname == "kp3" %}       
	{{rider.kp3|date:'H:i:s'}}
{% endif %}
{% if uname == "finish" %}       
	{{rider.finish|date:'H:i:s'}}
{% endif %}	         		         	
	</td>
	<td align="center">
	{{rider.reg_event.phone}}
	</td>

</tr>
{% endfor %}
</tbody>  
</table>	

<br><br>
<h3 style="font-size:16px; font-weight:bold; color: black;" title="Показати статистику" id="event_stat">Результати</h3>
<div id="tabs">
  <ul>
    <li><a href="#tabs-1">Стать</a></li>
    <li><a href="#tabs-2">Місто</a></li>
    <li><a href="#tabs-3">Велосипед</a></li>
    <li><a href="#tabs-4">Інше</a></li>
  </ul>
  <div id="tabs-1">
    <p>
    жінок - {{ list|res_statistic:"0" }}
	<br>
	чоловіків - {{ event|res_statistic:"1" }}
    </p>
  </div>
  <div id="tabs-2">
	<p>
	{% for city in list.riders_city %}
		{{city.city}} - {{city.num_city}}<br>
	{% endfor %}
	</p>
  </div>
  <div id="tabs-3">
    <p>
	{% for bike in event.riders_bike %}
		{{bike.bike_type__name}} - {{bike.num_bike}}<br>
	{% endfor %}
    </p>
  </div>
  <div id="tabs-4">
    <p>
    Оплачених - {{ event.riders_pay_count }}
	<br>    
    {% if user.is_authenticated %}
    Сума - {{ event.riders_pay_sum }}
    {% endif %}
    </p>
  </div>
  
</div>



{% endblock %}

	